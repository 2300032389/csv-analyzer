<!DOCTYPE html>
<html>
<head>
    <title>Universal CSV Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #141e30, #243b55);
            color: white;
            text-align: center;
        }

        .container {
            width: 90%;
            margin: auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 8px;
            border: none;
        }

        button {
            padding: 8px 15px;
            margin: 5px;
            background: linear-gradient(to right, #00c6ff, #0072ff);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            transform: scale(1.05);
        }

        table {
            margin: auto;
            border-collapse: collapse;
            width: 100%;
            color: white;
        }

        th, td {
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        th {
            background: rgba(255,255,255,0.1);
        }

        h1 {
            font-size: 32px;
            margin-top: 20px;
        }

        .error-card {
            background: rgba(255,0,0,0.2);
        }
    </style>
</head>

<body>

<div class="container">

<h1>ðŸ“Š Universal CSV Analyzer</h1>

<!-- ERROR MESSAGE -->
{% if error_message %}
<div class="card error-card">
    <p>{{ error_message }}</p>
</div>
{% endif %}

<!-- UPLOAD CSV -->
<div class="card">
<h2>Upload CSV</h2>
<form method="POST" enctype="multipart/form-data">
    <input type="file" name="csv_file" accept=".csv" required>
    <button name="upload_csv">Upload</button>
</form>
</div>

{% if numeric_columns %}

<!-- SORTING -->
<div class="card">
<h2>Sort Data</h2>
<form method="POST" enctype="multipart/form-data">
    <input type="file" name="csv_file" accept=".csv" required>

    <br>

    <label>Sort By:</label>
    <select name="sort_column">
        {% for col in numeric_columns %}
        <option value="{{ col }}">{{ col }}</option>
        {% endfor %}
    </select>

    <select name="sort_order">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
    </select>

    <button name="sort">Sort</button>
</form>
</div>

<!-- ANALYSIS -->
<div class="card">
<h2>Select Columns to Analyze</h2>
<form method="POST" enctype="multipart/form-data">

    <input type="file" name="csv_file" accept=".csv" required>

    <br>

    {% for col in numeric_columns %}
        <input type="checkbox" name="columns" value="{{ col }}"> {{ col }}
    {% endfor %}

    <br><br>

    <label>Chart Type:</label>
    <select name="chart_type">
        <option value="bar">Bar</option>
        <option value="line">Line</option>
        <option value="pie">Pie</option>
    </select>

    <br><br>

    <button name="analyze">Analyze</button>
</form>
</div>

{% endif %}

<!-- STATISTICS -->
{% if stats %}
<div class="card">
<h2>Statistics</h2>
{% for col, s in stats.items() %}
<p>
<b>{{ col }}</b> â†’ 
Average: {{ s.average }},
Highest: {{ s.highest }},
Lowest: {{ s.lowest }}
</p>
{% endfor %}
</div>
{% endif %}

<!-- DATA PREVIEW -->
{% if table %}
<div class="card">
<h2>Data Preview</h2>
{{ table | safe }}
</div>
{% endif %}

<!-- CHART -->
{% if values %}
<div class="card">
<h2>Visualization</h2>
<canvas id="myChart"></canvas>
</div>
{% endif %}

</div>

<script>
    const labels = JSON.parse('{{ labels | tojson | safe }}');
    const values = JSON.parse('{{ values | tojson | safe }}');
    const chartType = "{{ chart_type }}";

    if (values.length > 0) {

        const datasets = [];

        for (let i = 0; i < values[0].length; i++) {
            datasets.push({
                label: "Column " + (i + 1),
                data: values.map(row => row[i]),
                borderWidth: 1
            });
        }

        new Chart(document.getElementById('myChart'), {
            type: chartType,
            data: {
                labels: labels,
                datasets: datasets
            }
        });
    }
</script>

</body>
</html>
